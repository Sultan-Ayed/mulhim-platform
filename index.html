<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙÙ„Ù‡ÙÙ… Ø§Ù„Ø¨Ø­Ø«ÙŠ | Smart Academic Writing</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Playfair+Display:wght@400;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #0f0e0d;
    --paper: #f5f0e8;
    --cream: #ede8de;
    --gold: #c9a84c;
    --gold-light: #e8cf8a;
    --rust: #b5421a;
    --teal: #1a6b6b;
    --teal-light: #2a9d8f;
    --muted: #7a7268;
    --border: #d4cebf;
    --white: #fdfcfa;
    --shadow: rgba(15,14,13,0.12);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Tajawal', sans-serif;
    background: var(--paper);
    color: var(--ink);
    min-height: 100vh;
    direction: rtl;
  }

  body.en { direction: ltr; font-family: 'Playfair Display', 'Tajawal', sans-serif; }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    background: var(--ink);
    padding: 0 2.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 64px;
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 3px solid var(--gold);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .logo-icon {
    width: 36px; height: 36px;
    background: var(--gold);
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
  }

  .logo-text {
    font-size: 1.25rem;
    font-weight: 800;
    color: var(--white);
    letter-spacing: -0.02em;
  }

  .logo-sub {
    font-size: 0.7rem;
    color: var(--gold-light);
    font-weight: 300;
    font-family: 'IBM Plex Mono', monospace;
  }

  .header-controls {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .btn-lang {
    background: transparent;
    border: 1.5px solid var(--muted);
    color: var(--white);
    padding: 0.35rem 1rem;
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Tajawal', sans-serif;
  }
  .btn-lang:hover, .btn-lang.active {
    border-color: var(--gold);
    color: var(--gold);
  }

  .style-select {
    background: transparent;
    border: 1.5px solid var(--muted);
    color: var(--white);
    padding: 0.35rem 0.75rem;
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
    outline: none;
    font-family: 'Tajawal', monospace;
  }
  .style-select option { background: #1a1916; color: var(--white); }

  /* â”€â”€ MAIN LAYOUT â”€â”€ */
  .app-wrap {
    display: grid;
    grid-template-columns: 280px 1fr 340px;
    min-height: calc(100vh - 64px);
  }

  /* â”€â”€ SIDEBAR â”€â”€ */
  .sidebar {
    background: var(--ink);
    padding: 2rem 1.25rem;
    border-left: 1px solid #2a2925;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  body.en .sidebar { border-left: none; border-right: 1px solid #2a2925; }

  .sidebar-label {
    font-size: 0.65rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-family: 'IBM Plex Mono', monospace;
    margin-bottom: 0.5rem;
    padding-right: 0.5rem;
  }
  body.en .sidebar-label { padding-right: 0; padding-left: 0.5rem; }

  .template-btn {
    background: transparent;
    border: 1px solid #2a2925;
    color: #9a9082;
    padding: 0.85rem 1rem;
    border-radius: 8px;
    text-align: right;
    cursor: pointer;
    transition: all 0.22s;
    font-family: 'Tajawal', sans-serif;
    font-size: 0.88rem;
    line-height: 1.5;
    position: relative;
  }
  body.en .template-btn { text-align: left; }

  .template-btn .t-icon { font-size: 1.1rem; display: block; margin-bottom: 0.25rem; }
  .template-btn .t-name { display: block; font-weight: 700; color: #ccc5b9; font-size: 0.9rem; }
  .template-btn .t-desc { display: block; font-size: 0.72rem; color: var(--muted); margin-top: 0.15rem; }

  .template-btn:hover {
    border-color: var(--gold);
    background: rgba(201,168,76,0.07);
    color: var(--gold-light);
  }
  .template-btn.active {
    border-color: var(--gold);
    background: rgba(201,168,76,0.12);
  }
  .template-btn.active .t-name { color: var(--gold); }
  .template-btn.active::before {
    content: '';
    position: absolute;
    right: 0; top: 50%; transform: translateY(-50%);
    width: 3px; height: 60%;
    background: var(--gold);
    border-radius: 3px 0 0 3px;
  }
  body.en .template-btn.active::before {
    right: auto; left: 0;
    border-radius: 0 3px 3px 0;
  }

  .sidebar-divider {
    border: none;
    border-top: 1px solid #2a2925;
    margin: 1rem 0;
  }

  .progress-wrap { padding: 0.5rem; }
  .progress-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.7rem;
    color: var(--muted);
    margin-bottom: 0.5rem;
    font-family: 'IBM Plex Mono', monospace;
  }
  .progress-bar {
    height: 4px;
    background: #2a2925;
    border-radius: 2px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--teal-light), var(--gold));
    border-radius: 2px;
    transition: width 0.5s ease;
    width: 0%;
  }

  /* â”€â”€ FORM AREA â”€â”€ */
  .form-area {
    padding: 2.5rem 2rem;
    overflow-y: auto;
    background: var(--paper);
    background-image:
      radial-gradient(circle at 80% 10%, rgba(201,168,76,0.05) 0%, transparent 50%),
      radial-gradient(circle at 20% 80%, rgba(26,107,107,0.05) 0%, transparent 50%);
  }

  .form-header {
    margin-bottom: 2.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .form-title-en {
    font-size: 0.7rem;
    color: var(--gold);
    font-family: 'IBM Plex Mono', monospace;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 0.35rem;
  }

  .form-title {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--ink);
    line-height: 1.2;
  }

  .form-subtitle {
    color: var(--muted);
    font-size: 0.88rem;
    margin-top: 0.5rem;
    font-weight: 300;
  }

  /* â”€â”€ FIELD GROUP â”€â”€ */
  .field-section {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 1.25rem;
    overflow: hidden;
    box-shadow: 0 2px 8px var(--shadow);
    transition: box-shadow 0.2s;
  }
  .field-section:focus-within {
    box-shadow: 0 4px 20px rgba(201,168,76,0.15), 0 2px 8px var(--shadow);
    border-color: var(--gold-light);
  }

  .field-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.9rem 1.25rem;
    background: var(--cream);
    border-bottom: 1px solid var(--border);
    gap: 1rem;
  }

  .field-label-wrap { display: flex; flex-direction: column; gap: 0.15rem; }
  .field-label {
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--ink);
  }
  .field-label-en {
    font-size: 0.68rem;
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
    letter-spacing: 0.05em;
  }

  .field-hint-btn {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 50%;
    width: 26px; height: 26px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    font-size: 0.75rem;
    color: var(--muted);
    transition: all 0.2s;
    flex-shrink: 0;
  }
  .field-hint-btn:hover {
    background: var(--gold);
    border-color: var(--gold);
    color: var(--white);
  }

  .field-body { padding: 1.25rem; }

  .field-hint-box {
    background: linear-gradient(135deg, #fffdf5, #fdf9ee);
    border: 1px solid var(--gold-light);
    border-radius: 8px;
    padding: 0.85rem 1rem;
    margin-bottom: 1rem;
    font-size: 0.8rem;
    color: #7a6830;
    line-height: 1.7;
    display: none;
    position: relative;
  }
  .field-hint-box.visible { display: block; animation: slideDown 0.2s ease; }
  .field-hint-box::before {
    content: 'ğŸ’¡';
    margin-left: 0.4rem;
  }
  body.en .field-hint-box::before { margin-left: 0; margin-right: 0.4rem; }

  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  textarea, input[type="text"], select.field-select {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    font-family: 'Tajawal', sans-serif;
    font-size: 0.92rem;
    color: var(--ink);
    background: var(--paper);
    outline: none;
    resize: vertical;
    transition: border-color 0.2s;
    direction: inherit;
  }
  textarea:focus, input[type="text"]:focus, select.field-select:focus {
    border-color: var(--teal-light);
    background: var(--white);
  }
  textarea::placeholder, input::placeholder { color: #b0a99a; }

  .questions-list { display: flex; flex-direction: column; gap: 0.6rem; }
  .question-item {
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }
  .question-num {
    width: 26px; height: 26px;
    background: var(--ink);
    color: var(--gold);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.7rem;
    font-weight: 700;
    flex-shrink: 0;
    font-family: 'IBM Plex Mono', monospace;
  }
  .question-item input { margin: 0; }

  .add-q-btn {
    background: transparent;
    border: 1.5px dashed var(--border);
    border-radius: 8px;
    padding: 0.5rem;
    width: 100%;
    cursor: pointer;
    color: var(--muted);
    font-family: 'Tajawal', sans-serif;
    font-size: 0.82rem;
    margin-top: 0.5rem;
    transition: all 0.2s;
  }
  .add-q-btn:hover { border-color: var(--teal-light); color: var(--teal); }

  /* â”€â”€ EXPORT BTN â”€â”€ */
  .export-wrap {
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .btn-export {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.85rem 1.75rem;
    border-radius: 8px;
    font-family: 'Tajawal', sans-serif;
    font-size: 0.95rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.22s;
    border: none;
  }

  .btn-primary {
    background: var(--ink);
    color: var(--gold);
    box-shadow: 0 4px 16px rgba(15,14,13,0.3);
  }
  .btn-primary:hover {
    background: #1a1916;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(15,14,13,0.4);
  }

  .btn-secondary {
    background: transparent;
    color: var(--ink);
    border: 1.5px solid var(--border);
  }
  .btn-secondary:hover { border-color: var(--ink); }

  .autosave-indicator {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.75rem;
    color: var(--teal-light);
    font-family: 'IBM Plex Mono', monospace;
    margin-top: 0.75rem;
  }
  .save-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--teal-light);
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  /* â”€â”€ PREVIEW â”€â”€ */
  .preview-panel {
    background: var(--white);
    border-right: 1px solid var(--border);
    border-left: none;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: -4px 0 20px var(--shadow);
  }
  body.en .preview-panel {
    border-right: none;
    border-left: 1px solid var(--border);
    box-shadow: 4px 0 20px var(--shadow);
  }

  .preview-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border);
    background: var(--cream);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .preview-title {
    font-size: 0.7rem;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .preview-badge {
    background: var(--teal);
    color: var(--white);
    font-size: 0.6rem;
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    font-family: 'IBM Plex Mono', monospace;
    letter-spacing: 0.1em;
  }

  .preview-doc {
    flex: 1;
    overflow-y: auto;
    padding: 2rem 1.5rem;
    font-family: 'Georgia', serif;
    font-size: 0.82rem;
    line-height: 1.9;
    color: #2a2520;
  }

  .doc-uni-header {
    text-align: center;
    border-bottom: 2px solid var(--ink);
    padding-bottom: 1rem;
    margin-bottom: 1.5rem;
  }
  .doc-uni-name {
    font-size: 0.85rem;
    font-weight: bold;
    letter-spacing: 0.05em;
  }
  .doc-doc-type {
    font-size: 1rem;
    font-weight: bold;
    margin-top: 0.25rem;
  }
  .doc-style-tag {
    font-size: 0.65rem;
    color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
    margin-top: 0.25rem;
  }

  .doc-section {
    margin-bottom: 1.25rem;
    animation: fadeIn 0.4s ease;
  }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .doc-section-title {
    font-size: 0.78rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    border-bottom: 1px solid var(--border);
    padding-bottom: 0.3rem;
    margin-bottom: 0.6rem;
    color: var(--ink);
  }

  .doc-section-body {
    font-size: 0.8rem;
    color: #4a4540;
    line-height: 1.8;
    white-space: pre-wrap;
    word-break: break-word;
  }

  .doc-placeholder {
    color: #c0bab0;
    font-style: italic;
    font-size: 0.78rem;
  }

  /* â”€â”€ WELCOME â”€â”€ */
  .welcome-screen {
    grid-column: 2 / 4;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    text-align: center;
  }

  .welcome-inner { max-width: 480px; }

  .welcome-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    display: block;
  }

  .welcome-title {
    font-size: 2rem;
    font-weight: 800;
    color: var(--ink);
    line-height: 1.2;
    margin-bottom: 0.75rem;
  }

  .welcome-sub {
    color: var(--muted);
    font-size: 0.95rem;
    line-height: 1.7;
    margin-bottom: 2rem;
  }

  .welcome-arrow {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: var(--gold);
    font-weight: 600;
    animation: bounceLeft 1.5s infinite;
  }

  @keyframes bounceLeft {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(-8px); }
  }
  body.en .welcome-arrow { animation-name: bounceRight; }
  @keyframes bounceRight {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(8px); }
  }

  /* â”€â”€ RESPONSIVE â”€â”€ */
  @media (max-width: 1100px) {
    .app-wrap { grid-template-columns: 240px 1fr; }
    .preview-panel { display: none; }
  }
  @media (max-width: 700px) {
    .app-wrap { grid-template-columns: 1fr; }
    .sidebar { display: none; }
  }

  /* â”€â”€ TOAST â”€â”€ */
  .toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--ink);
    color: var(--gold);
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-size: 0.88rem;
    font-family: 'Tajawal', sans-serif;
    border: 1px solid var(--gold);
    transition: transform 0.35s ease;
    z-index: 999;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">âœ¦</div>
    <div>
      <div class="logo-text" id="logoText">Ù…ÙÙ„Ù‡ÙÙ… Ø§Ù„Ø¨Ø­Ø«ÙŠ</div>
      <div class="logo-sub" id="logoSub">SMART ACADEMIC PLATFORM</div>
    </div>
  </div>
  <div class="header-controls">
    <select class="style-select" id="styleSelect">
      <option value="APA">APA 7th</option>
      <option value="MLA">MLA 9th</option>
      <option value="IEEE">IEEE</option>
      <option value="Chicago">Chicago</option>
    </select>
    <button class="btn-lang active" onclick="setLang('ar')" id="btnAr">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    <button class="btn-lang" onclick="setLang('en')" id="btnEn">English</button>
  </div>
</header>

<div class="app-wrap">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-label" id="sideLabel">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨</div>

    <button class="template-btn" onclick="selectTemplate('proposal')" id="tpl-proposal">
      <span class="t-icon">ğŸ“‹</span>
      <span class="t-name" id="t1n">Ø§Ù„Ù…Ù‚ØªØ±Ø­ Ø§Ù„Ø¨Ø­Ø«ÙŠ</span>
      <span class="t-desc" id="t1d">Research Proposal</span>
    </button>

    <button class="template-btn" onclick="selectTemplate('literature')" id="tpl-literature">
      <span class="t-icon">ğŸ“š</span>
      <span class="t-name" id="t2n">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ø¨ÙŠØ§Øª</span>
      <span class="t-desc" id="t2d">Literature Review</span>
    </button>

    <button class="template-btn" onclick="selectTemplate('thesis')" id="tpl-thesis">
      <span class="t-icon">ğŸ“</span>
      <span class="t-name" id="t3n">Ø§Ù„Ø£Ø·Ø±ÙˆØ­Ø© Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</span>
      <span class="t-desc" id="t3d">Thesis / Dissertation</span>
    </button>

    <button class="template-btn" onclick="selectTemplate('paper')" id="tpl-paper">
      <span class="t-icon">ğŸ“„</span>
      <span class="t-name" id="t4n">Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø¨Ø­Ø«ÙŠØ©</span>
      <span class="t-desc" id="t4d">Research Paper</span>
    </button>

    <hr class="sidebar-divider">

    <div class="progress-wrap">
      <div class="progress-label">
        <span id="progressLabel">Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</span>
        <span id="progressPct">0%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
  </aside>

  <!-- WELCOME / FORM -->
  <div id="mainContent">
    <div class="welcome-screen" id="welcomeScreen">
      <div class="welcome-inner">
        <span class="welcome-icon">âœ¦</span>
        <h1 class="welcome-title" id="welcomeTitle">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¨Ø­Ø«ÙŠØ©</h1>
        <p class="welcome-sub" id="welcomeSub">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ¨Ø¯Ø£ ÙÙŠ ÙƒØªØ§Ø¨Ø© Ø¨Ø­Ø«Ùƒ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù†Ø¸Ù…Ø© ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©.</p>
        <div class="welcome-arrow" id="welcomeArrow">â† Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©</div>
      </div>
    </div>

    <div class="form-area" id="formArea" style="display:none">
      <div class="form-header">
        <div class="form-title-en" id="formTitleEn">RESEARCH PROPOSAL TEMPLATE</div>
        <h2 class="form-title" id="formTitle">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù‚ØªØ±Ø­ Ø§Ù„Ø¨Ø­Ø«ÙŠ</h2>
        <p class="form-subtitle" id="formSubtitle">Ø£ÙƒÙ…Ù„ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ÙˆØ³ØªØ¸Ù‡Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø­Ø«Ùƒ ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø±</p>
      </div>

      <div id="fieldsContainer"></div>

      <div class="export-wrap">
        <button class="btn-export btn-primary" onclick="exportDoc()">
          <span>â¬‡</span>
          <span id="exportBtn">ØªØµØ¯ÙŠØ± Word</span>
        </button>
        <button class="btn-export btn-secondary" onclick="exportPDF()">
          <span>ğŸ“„</span>
          <span id="exportPdfBtn">ØªØµØ¯ÙŠØ± PDF</span>
        </button>
      </div>
      <div class="autosave-indicator">
        <div class="save-dot"></div>
        <span id="autoSaveLabel">Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù‘Ù„</span>
      </div>
    </div>
  </div>

  <!-- PREVIEW -->
  <aside class="preview-panel">
    <div class="preview-header">
      <span class="preview-title" id="previewLabel">Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</span>
      <span class="preview-badge" id="styleTag">APA 7th</span>
    </div>
    <div class="preview-doc" id="previewDoc">
      <div style="text-align:center; color: #c0bab0; padding: 4rem 1rem; font-style:italic; font-size:0.82rem;" id="previewEmpty">
        Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨Ø§Ù‹ Ù„ØªØ±Ù‰ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‡Ù†Ø§...
      </div>
    </div>
  </aside>

</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let lang = 'ar';
let currentTemplate = null;
let formData = {};
let questionCounts = {};

// â”€â”€â”€ TRANSLATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const T = {
  ar: {
    sideLabel: 'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨',
    welcomeTitle: 'Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¨Ø­Ø«ÙŠØ©',
    welcomeSub: 'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ¨Ø¯Ø£ ÙÙŠ ÙƒØªØ§Ø¨Ø© Ø¨Ø­Ø«Ùƒ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù†Ø¸Ù…Ø© ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©.',
    welcomeArrow: 'â† Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©',
    previewLabel: 'Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¨Ø§Ø´Ø±Ø©',
    progressLabel: 'Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬',
    autoSaveLabel: 'Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù‘Ù„',
    exportBtn: 'ØªØµØ¯ÙŠØ± Word',
    exportPdfBtn: 'ØªØµØ¯ÙŠØ± PDF',
    addQ: '+ Ø£Ø¶Ù Ø³Ø¤Ø§Ù„Ø§Ù‹',
    hint: 'Ù†ØµÙŠØ­Ø©',
    formSubtitle: 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ÙˆØ³ØªØ¸Ù‡Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø­Ø«Ùƒ ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø±',
    previewEmpty: 'Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨Ø§Ù‹ Ù„ØªØ±Ù‰ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‡Ù†Ø§...',
    toastWord: 'âœ” ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Word Ø¨Ù†Ø¬Ø§Ø­',
    toastPdf: 'âœ” ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­',
  },
  en: {
    sideLabel: 'Choose Template Type',
    welcomeTitle: 'Start Your Research Journey',
    welcomeSub: 'Select a template type from the sidebar to begin writing your research in an organized, professional manner.',
    welcomeArrow: 'Choose a template from the sidebar â†’',
    previewLabel: 'Live Preview',
    progressLabel: 'Form Completion',
    autoSaveLabel: 'Auto-save enabled',
    exportBtn: 'Export Word',
    exportPdfBtn: 'Export PDF',
    addQ: '+ Add Question',
    hint: 'Tip',
    formSubtitle: 'Complete the fields below and your research preview will appear on the right.',
    previewEmpty: 'Select a template to see the preview here...',
    toastWord: 'âœ” Word file created successfully',
    toastPdf: 'âœ” PDF file created successfully',
  }
};

// â”€â”€â”€ TEMPLATES CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TEMPLATES = {
  proposal: {
    ar: { title: 'Ø§Ù„Ù…Ù‚ØªØ±Ø­ Ø§Ù„Ø¨Ø­Ø«ÙŠ', titleEn: 'RESEARCH PROPOSAL TEMPLATE' },
    en: { title: 'Research Proposal', titleEn: 'RESEARCH PROPOSAL TEMPLATE' },
    fields: [
      {
        id: 'title',
        ar: { label: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«', hint: 'ØµØº Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ ÙˆØ§Ø¶Ø­Ø§Ù‹ ÙˆÙ…Ø­Ø¯Ø¯Ø§Ù‹ ÙŠØ¹ÙƒØ³ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø© ÙˆÙŠØªØ¶Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©. ÙŠÙÙØ¶Ù‘Ù„ Ø£Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 15 ÙƒÙ„Ù…Ø©.' },
        en: { label: 'Research Title', hint: 'Write a clear and specific title that reflects the research problem and includes the main variables. Ideally no more than 15 words.' },
        type: 'text',
        placeholder: { ar: 'Ù…Ø«Ø§Ù„: Ø£Ø«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©...', en: 'e.g., The Impact of AI Tools on Academic Achievement Among University Students...' }
      },
      {
        id: 'problem',
        ar: { label: 'Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©', hint: 'Ø§Ø¨Ø¯Ø£ Ø¨ÙˆØµÙ Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© Ø£Ùˆ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ Ø«Ù… Ø¨ÙŠÙ‘Ù† Ø§Ù„ÙØ¬ÙˆØ© Ø§Ù„Ù…Ø¹Ø±ÙÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø¯Ø¨ÙŠØ§ØªØŒ ÙˆØ§Ø®ØªÙ… Ø¨ØµÙŠØ§ØºØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙƒØ³Ø¤Ø§Ù„ Ù…Ø­ÙˆØ±ÙŠ.' },
        en: { label: 'Problem Statement', hint: 'Start by describing the phenomenon or issue, then identify the knowledge gap in existing literature, and conclude by framing the problem as a central question.' },
        type: 'textarea',
        placeholder: { ar: 'ØªÙØ¹Ø¯Ù‘ Ø¸Ø§Ù‡Ø±Ø©... Ù…Ù† Ø£Ø¨Ø±Ø² Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ØªÙŠ ØªÙˆØ§Ø¬Ù‡... ÙˆÙ‚Ø¯ Ù„Ø§Ø­Ø¸ Ø§Ù„Ø¨Ø§Ø­Ø«ÙˆÙ† ØºÙŠØ§Ø¨Ø§Ù‹ ÙˆØ§Ø¶Ø­Ø§Ù‹ ÙÙŠ...', en: 'The phenomenon of... represents one of the most pressing challenges in... Researchers have noted a clear gap in...' }
      },
      {
        id: 'questions',
        ar: { label: 'Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©', hint: 'ØµØº ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ø¨Ø¯Ø¡Ø§Ù‹ Ø¨Ù€ "Ù…Ø§ØŒ ÙƒÙŠÙØŒ Ù‡Ù„ØŒ Ù…Ø§ Ù…Ø¯Ù‰". ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚ÙŠØ§Ø³ ÙˆØªØ±ØªØ¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø§Ù„Ù…Ø´ÙƒÙ„Ø©.' },
        en: { label: 'Research Questions', hint: 'Frame each question starting with "What, How, Does, To what extent". Questions must be measurable and directly linked to the problem.' },
        type: 'questions',
        placeholder: { ar: 'Ø£Ø¯Ø®Ù„ Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø¨Ø­Ø«ÙŠØ§Ù‹...', en: 'Enter a research question...' }
      },
      {
        id: 'objectives',
        ar: { label: 'Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø¯Ø±Ø§Ø³Ø©', hint: 'Ø§Ø³ØªØ®Ø¯Ù… Ø£ÙØ¹Ø§Ù„ Ø¥Ø¬Ø±Ø§Ø¦ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù‚ÙŠØ§Ø³: ÙŠØ­Ø¯Ø¯ØŒ ÙŠÙ‚ÙŠØ³ØŒ ÙŠÙ‚Ø§Ø±Ù†ØŒ ÙŠØ­Ù„Ù„ØŒ ÙŠØ®ØªØ¨Ø±. Ø§Ø±Ø¨Ø· ÙƒÙ„ Ù‡Ø¯Ù Ø¨Ø³Ø¤Ø§Ù„ Ø¨Ø­Ø«ÙŠ.' },
        en: { label: 'Study Objectives', hint: 'Use measurable action verbs: identify, measure, compare, analyze, test. Link each objective to a research question.' },
        type: 'textarea',
        placeholder: { ar: '1. Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰...\n2. Ù‚ÙŠØ§Ø³ Ù…Ø³ØªÙˆÙ‰...\n3. Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ†...', en: '1. To identify...\n2. To measure the level of...\n3. To compare between...' }
      },
      {
        id: 'methodology',
        ar: { label: 'Ù…Ù†Ù‡Ø¬ÙŠØ© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©', hint: 'Ø­Ø¯Ø¯ Ø§Ù„Ù…Ù†Ù‡Ø¬ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ø¹ÙŠÙ†Ø©. Ø¨Ø±Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ø¨ÙŠØ¹Ø© Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©.' },
        en: { label: 'Methodology', hint: 'Specify the approach, instruments, and sample. Justify the choice of methodology based on the nature of the research problem.' },
        type: 'select',
        options: {
          ar: ['Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„ÙƒÙ…ÙŠ - Quantitative', 'Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ù†ÙˆØ¹ÙŠ - Qualitative', 'Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ù…Ø®ØªÙ„Ø· - Mixed Methods', 'Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ - Experimental', 'Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„ÙˆØµÙÙŠ - Descriptive'],
          en: ['Quantitative Approach', 'Qualitative Approach', 'Mixed Methods', 'Experimental Design', 'Descriptive Survey']
        }
      },
      {
        id: 'references',
        ar: { label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ ÙˆØ§Ù„Ù…ØµØ§Ø¯Ø±', hint: 'Ø£Ø¯Ø®Ù„ Ù…Ø±Ø§Ø¬Ø¹Ùƒ Ø¨ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ù…Ø®ØªØ§Ø± (APA/MLA/IEEE). ØªØ£ÙƒØ¯ Ù…Ù† Ø°ÙƒØ± Ø§Ù„Ù…Ø¤Ù„ÙØŒ Ø§Ù„Ø³Ù†Ø©ØŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù†Ø§Ø´Ø±Ø©.' },
        en: { label: 'References', hint: 'Enter your references in the selected citation style (APA/MLA/IEEE). Ensure author, year, title, and publisher are included.' },
        type: 'textarea',
        placeholder: { ar: 'Ø§Ù„Ø­Ø±Ø¨ÙŠØŒ Ø®Ø§Ù„Ø¯. (2022). ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù„ÙŠ. Ù…Ø¬Ù„Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ©ØŒ 45(2)ØŒ 112-135.\nSmith, J. (2021). AI in Education...', en: 'Smith, J. (2021). AI in Education: A Systematic Review. Journal of Educational Technology, 45(2), 112â€“135.\nJones, M., & Lee, K. (2020)...' }
      }
    ]
  },
  literature: {
    ar: { title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ø¨ÙŠØ§Øª', titleEn: 'LITERATURE REVIEW TEMPLATE' },
    en: { title: 'Literature Review', titleEn: 'LITERATURE REVIEW TEMPLATE' },
    fields: [
      { id: 'title', ar: { label: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', hint: 'Ø­Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙˆØ§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©. Ù…Ø«Ø§Ù„: Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù†Ù‡Ø¬ÙŠØ© Ù„Ø¯Ø±Ø§Ø³Ø§Øª... Ø®Ù„Ø§Ù„ Ø§Ù„ÙØªØ±Ø© 2010-2023' }, en: { label: 'Review Title', hint: 'Define the topic and time scope of the review. Example: A Systematic Review of... During 2010â€“2023.' }, type: 'text', placeholder: { ar: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù†Ù‡Ø¬ÙŠØ© Ù„Ø¯Ø±Ø§Ø³Ø§Øª...', en: 'A Systematic Review of...' } },
      { id: 'scope', ar: { label: 'Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆÙ‡Ø¯ÙÙ‡Ø§', hint: 'ÙˆØ¶Ø­ Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ ÙˆØ§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©ØŒ ÙˆØ§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ ÙˆØ§Ù„Ø²Ù…Ù†ÙŠ.' }, en: { label: 'Scope & Purpose', hint: 'Clarify the purpose of the review, target population, and geographical and temporal scope.' }, type: 'textarea', placeholder: { ar: 'ØªÙ‡Ø¯Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ù„Ù‰ ØªØ¬Ù…ÙŠØ¹ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„ØªÙŠ ØªÙ†Ø§ÙˆÙ„Øª...', en: 'This review aims to synthesize and analyze studies that examined...' } },
      { id: 'themes', ar: { label: 'Ø§Ù„Ù…Ø­Ø§ÙˆØ± ÙˆØ§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', hint: 'ØµÙ†Ù‘Ù Ø§Ù„Ø£Ø¯Ø¨ÙŠØ§Øª Ø¶Ù…Ù† Ù…Ø­Ø§ÙˆØ± Ù…ÙˆØ¶ÙˆØ¹ÙŠØ©. Ø§Ø°ÙƒØ± Ø§Ù„Ø§ØªÙØ§Ù‚Ø§Øª ÙˆØ§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ†.' }, en: { label: 'Main Themes & Findings', hint: 'Categorize literature into thematic groups. Note agreements and disagreements among researchers.' }, type: 'textarea', placeholder: { ar: 'Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø£ÙˆÙ„: ...\nØ§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙŠ: ...\nØ§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù„Ø«: ...', en: 'Theme 1: ...\nTheme 2: ...\nTheme 3: ...' } },
      { id: 'gaps', ar: { label: 'Ø§Ù„ÙØ¬ÙˆØ§Øª Ø§Ù„Ø¨Ø­Ø«ÙŠØ©', hint: 'Ù‡Ø°Ø§ Ø£Ù‡Ù… Ø¬Ø²Ø¡. Ø­Ø¯Ø¯ Ù…Ø§ Ù„Ù… ØªØ¯Ø±Ø³Ù‡ Ø§Ù„Ø£Ø¨Ø­Ø§Ø« Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©ØŒ ÙˆØ£ÙŠÙ† ØªÙƒÙ…Ù† Ø§Ù„Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¨Ø­Ø«.' }, en: { label: 'Research Gaps', hint: 'This is the most critical section. Identify what prior research has not addressed and where further investigation is needed.' }, type: 'textarea', placeholder: { ar: 'Ø±ØºÙ… ØªØ¹Ø¯Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ø§Ù„ØŒ Ø¥Ù„Ø§ Ø£Ù†Ù‡Ø§ Ø£ØºÙÙ„Øª...', en: 'Despite extensive research in this field, existing studies have neglected...' } },
      { id: 'references', ar: { label: 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹', hint: 'Ø±ØªØ¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø£Ø¨Ø¬Ø¯ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ù†Ù…Ø· Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø®ØªØ§Ø±.' }, en: { label: 'References', hint: 'Arrange references alphabetically according to the selected citation style.' }, type: 'textarea', placeholder: { ar: 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ù‡Ù†Ø§...', en: 'Enter references here...' } }
    ]
  },
  thesis: {
    ar: { title: 'Ø§Ù„Ø£Ø·Ø±ÙˆØ­Ø© Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©', titleEn: 'THESIS / DISSERTATION TEMPLATE' },
    en: { title: 'Thesis / Dissertation', titleEn: 'THESIS / DISSERTATION TEMPLATE' },
    fields: [
      { id: 'title', ar: { label: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø£Ø·Ø±ÙˆØ­Ø©', hint: 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø´Ø§Ù…Ù„Ø§Ù‹ ÙˆØ¯Ù‚ÙŠÙ‚Ø§Ù‹ ÙˆÙŠØ¹ÙƒØ³ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ø·Ø±ÙˆØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.' }, en: { label: 'Thesis Title', hint: 'The title must be comprehensive and precise, fully reflecting the content of the thesis.' }, type: 'text', placeholder: { ar: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø£Ø·Ø±ÙˆØ­Ø©...', en: 'Thesis title...' } },
      { id: 'abstract', ar: { label: 'Ø§Ù„Ù…Ù„Ø®Øµ (Abstract)', hint: 'Ø§ÙƒØªØ¨ Ù…Ù„Ø®ØµØ§Ù‹ Ù…Ù† 200-350 ÙƒÙ„Ù…Ø© ÙŠØ´Ù…Ù„: Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ©ØŒ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ Ø§Ù„ØªÙˆØµÙŠØ§Øª. Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ù…Ø±Ø§Ø¬Ø¹ ÙÙŠ Ø§Ù„Ù…Ù„Ø®Øµ.' }, en: { label: 'Abstract', hint: 'Write a 200â€“350 word abstract covering: the problem, methodology, findings, and recommendations. Do not include references in the abstract.' }, type: 'textarea', placeholder: { ar: 'ØªØªÙ†Ø§ÙˆÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ù…Ø´ÙƒÙ„Ø©... Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†Ù‡Ø¬... ÙˆÙ‚Ø¯ ØªÙˆØµÙ„Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø¥Ù„Ù‰...', en: 'This study examines the problem of... using a... methodology. The study found that...' } },
      { id: 'intro', ar: { label: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©', hint: 'Ø§Ø¨Ø¯Ø£ Ø¨Ø¹Ø§Ù… Ø«Ù… Ø¶ÙŠÙ‘Ù‚ Ù†Ø­Ùˆ Ø§Ù„Ø®Ø§Øµ. ØªØ¶Ù…Ù‘Ù†: Ø§Ù„Ø³ÙŠØ§Ù‚ØŒ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©ØŒ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ Ø§Ù„Ø£Ù‡Ø¯Ø§ÙØŒ Ù…Ø­Ø¯Ø¯Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø©.' }, en: { label: 'Chapter 1: Introduction', hint: 'Begin broadly then narrow to the specific. Include: context, significance, problem, objectives, and scope of study.' }, type: 'textarea', placeholder: { ar: 'ÙŠØ´Ù‡Ø¯ Ø§Ù„Ø¹Ø§Ù„Ù… ØªØ­ÙˆÙ„Ø§Øª Ù…ØªØ³Ø§Ø±Ø¹Ø© ÙÙŠ Ù…Ø¬Ø§Ù„...', en: 'The world is witnessing rapid transformations in the field of...' } },
      { id: 'methodology', ar: { label: 'Ù…Ù†Ù‡Ø¬ÙŠØ© Ø§Ù„Ø¨Ø­Ø«', hint: 'Ø§Ø´Ø±Ø­ Ø¨Ø§Ù„ØªÙØµÙŠÙ„: Ø§Ù„Ù…Ù†Ù‡Ø¬ØŒ Ù…Ø¬ØªÙ…Ø¹ ÙˆØ¹ÙŠÙ†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©ØŒ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù‚ÙŠØ§Ø³ØŒ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙˆØ§Ù„Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©.' }, en: { label: 'Research Methodology', hint: 'Describe in detail: the approach, population and sample, measurement instruments, data collection procedures, and statistical methods.' }, type: 'textarea', placeholder: { ar: 'Ø§Ø¹ØªÙ…Ø¯Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ù‡Ø¬...', en: 'This study adopted a... approach...' } },
      { id: 'findings', ar: { label: 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„', hint: 'Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨ØªØ±ØªÙŠØ¨ Ù…Ù†Ø·Ù‚ÙŠ ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ø£Ø´ÙƒØ§Ù„ Ø­ÙŠØ« ÙŠÙ†Ø¨ØºÙŠ.' }, en: { label: 'Findings & Analysis', hint: 'Present findings in a logical order aligned with the research questions. Use tables and figures where appropriate.' }, type: 'textarea', placeholder: { ar: 'Ø£Ø¸Ù‡Ø±Øª Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø£Ù†...', en: 'The findings of the study revealed that...' } },
      { id: 'references', ar: { label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹', hint: 'Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©.' }, en: { label: 'References', hint: 'Enter all references used in the thesis.' }, type: 'textarea', placeholder: { ar: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø£Ø¬Ù†Ø¨ÙŠØ©...', en: 'Arabic and international references...' } }
    ]
  },
  paper: {
    ar: { title: 'Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø¨Ø­Ø«ÙŠØ©', titleEn: 'RESEARCH PAPER TEMPLATE' },
    en: { title: 'Research Paper', titleEn: 'RESEARCH PAPER TEMPLATE' },
    fields: [
      { id: 'title', ar: { label: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ±Ù‚Ø©', hint: 'Ø¹Ù†ÙˆØ§Ù† Ù‚ØµÙŠØ± ÙˆØ¬Ø°Ø§Ø¨ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 12 ÙƒÙ„Ù…Ø©. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­Ù…Ù„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ù„Ù…ÙŠØ©.' }, en: { label: 'Paper Title', hint: 'A concise and compelling title not exceeding 12 words. Must contain keywords for journal indexing.' }, type: 'text', placeholder: { ar: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø¨Ø­Ø«ÙŠØ©...', en: 'Paper title...' } },
      { id: 'abstract', ar: { label: 'Ø§Ù„Ù…Ù„Ø®Øµ', hint: 'Ù…Ù„Ø®Øµ Ù…Ù†Ø¸Ù… (structured abstract) ÙŠØªØ¶Ù…Ù†: Ø§Ù„Ù‡Ø¯ÙØŒ Ø§Ù„Ù…Ù†Ù‡Ø¬ØŒ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ Ø§Ù„Ø§Ø³ØªÙ†ØªØ§Ø¬. 150-250 ÙƒÙ„Ù…Ø©.' }, en: { label: 'Abstract', hint: 'Structured abstract including: Purpose, Methodology, Findings, Conclusion. 150â€“250 words.' }, type: 'textarea', placeholder: { ar: 'Ø§Ù„Ù‡Ø¯Ù: ...\nØ§Ù„Ù…Ù†Ù‡Ø¬: ...\nØ§Ù„Ù†ØªØ§Ø¦Ø¬: ...\nØ§Ù„Ø§Ø³ØªÙ†ØªØ§Ø¬: ...', en: 'Purpose: ...\nMethodology: ...\nFindings: ...\nConclusion: ...' } },
      { id: 'keywords', ar: { label: 'Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©', hint: 'Ø§Ø®ØªØ± 5-7 ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© ØªØ¹ÙƒØ³ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ. ØªÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨ÙØ§ØµÙ„Ø©.' }, en: { label: 'Keywords', hint: 'Choose 5â€“7 keywords reflecting the main topic, separated by commas.' }, type: 'text', placeholder: { ar: 'Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ Ø§Ù„Ø«Ø§Ù†ÙŠØ©ØŒ Ø§Ù„Ø«Ø§Ù„Ø«Ø©...', en: 'keyword one, keyword two, keyword three...' } },
      { id: 'intro', ar: { label: 'Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©', hint: 'Ø¶Ø¹ Ø³ÙŠØ§Ù‚ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©ØŒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ÙˆØ¬Ø²Ø© Ù„Ù„Ø£Ø¯Ø¨ÙŠØ§ØªØŒ Ø§Ù„ÙØ¬ÙˆØ© Ø§Ù„Ø¨Ø­Ø«ÙŠØ©ØŒ Ø«Ù… Ù‡Ø¯Ù Ø§Ù„ÙˆØ±Ù‚Ø©.' }, en: { label: 'Introduction', hint: 'Provide study context, brief literature overview, research gap, then the paper's aim.' }, type: 'textarea', placeholder: { ar: 'ØªÙØ¹Ø¯Ù‘ Ù‚Ø¶ÙŠØ©... Ù…Ù† Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„Ù…Ø­ÙˆØ±ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„...', en: 'The issue of... represents a central concern in the field of...' } },
      { id: 'methodology', ar: { label: 'Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ©', hint: 'Ø§Ø´Ø±Ø­ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø­Ø«ÙŠØŒ Ø§Ù„Ø¹ÙŠÙ†Ø©ØŒ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù‚ÙŠØ§Ø³ØŒ ÙˆØ¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„.' }, en: { label: 'Methodology', hint: 'Explain the research design, sample, measurement tools, and analysis procedures.' }, type: 'textarea', placeholder: { ar: 'ØªØ¨Ù†Ù‘Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ù†Ù‡Ø¬...', en: 'The current study adopted a...' } },
      { id: 'results', ar: { label: 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©', hint: 'Ù†Ø§Ù‚Ø´ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø¶ÙˆØ¡ Ø§Ù„Ø£Ø¯Ø¨ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©. Ø£Ø´Ø± Ø¥Ù„Ù‰ Ø£ÙˆØ¬Ù‡ Ø§Ù„Ø§ØªÙØ§Ù‚ ÙˆØ§Ù„Ø§Ø®ØªÙ„Ø§Ù Ù…Ø¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.' }, en: { label: 'Results & Discussion', hint: 'Discuss findings in light of prior literature. Highlight agreements and disagreements with existing studies.' }, type: 'textarea', placeholder: { ar: 'Ø£Ø³ÙØ±Øª Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¹Ù†...', en: 'The analysis yielded...' } },
      { id: 'conclusion', ar: { label: 'Ø§Ù„Ø®Ø§ØªÙ…Ø© ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª', hint: 'Ù„Ø®Øµ Ø£Ø¨Ø±Ø² Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ Ø§Ø°ÙƒØ± Ù…Ø­Ø¯ÙˆØ¯ÙŠØ© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©ØŒ Ø«Ù… Ù‚Ø¯Ù… ØªÙˆØµÙŠØ§Øª Ù„Ù„Ø¨Ø§Ø­Ø«ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠÙŠÙ†.' }, en: { label: 'Conclusion & Recommendations', hint: 'Summarize key findings, acknowledge study limitations, and provide recommendations for future researchers.' }, type: 'textarea', placeholder: { ar: 'Ø®Ù„ØµØª Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø¥Ù„Ù‰...', en: 'The study concluded that...' } },
      { id: 'references', ar: { label: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹', hint: 'Ø±ØªØ¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ ÙˆÙÙ‚ Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ù…Ø®ØªØ§Ø±.' }, en: { label: 'References', hint: 'Arrange references according to the selected style.' }, type: 'textarea', placeholder: { ar: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹...', en: 'References...' } }
    ]
  }
};

const TEMPLATE_META = {
  proposal: { ar: { name: 'Ø§Ù„Ù…Ù‚ØªØ±Ø­ Ø§Ù„Ø¨Ø­Ø«ÙŠ', desc: 'Research Proposal' }, en: { name: 'Research Proposal', desc: 'Ø®Ø·Ø· Ø§Ù„Ø£Ø¨Ø­Ø§Ø« ÙˆØ§Ù„Ø¥Ø´Ø±Ø§Ù' } },
  literature: { ar: { name: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ø¨ÙŠØ§Øª', desc: 'Literature Review' }, en: { name: 'Literature Review', desc: 'Ù†Ù‚Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©' } },
  thesis: { ar: { name: 'Ø§Ù„Ø£Ø·Ø±ÙˆØ­Ø© Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©', desc: 'Thesis / Dissertation' }, en: { name: 'Thesis / Dissertation', desc: 'Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø·ÙˆÙŠÙ„Ø©' } },
  paper: { ar: { name: 'Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø¨Ø­Ø«ÙŠØ©', desc: 'Research Paper' }, en: { name: 'Research Paper', desc: 'Ù„Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø§Øª' } }
};

// â”€â”€â”€ LANGUAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setLang(l) {
  lang = l;
  document.documentElement.lang = l;
  document.body.classList.toggle('en', l === 'en');
  document.body.dir = l === 'ar' ? 'rtl' : 'ltr';

  document.getElementById('btnAr').classList.toggle('active', l === 'ar');
  document.getElementById('btnEn').classList.toggle('active', l === 'en');

  // Update static text
  const t = T[l];
  document.getElementById('sideLabel').textContent = t.sideLabel;
  document.getElementById('welcomeTitle').textContent = t.welcomeTitle;
  document.getElementById('welcomeSub').textContent = t.welcomeSub;
  document.getElementById('welcomeArrow').textContent = t.welcomeArrow;
  document.getElementById('previewLabel').textContent = t.previewLabel;
  document.getElementById('progressLabel').textContent = t.progressLabel;
  document.getElementById('autoSaveLabel').textContent = t.autoSaveLabel;
  document.getElementById('exportBtn').textContent = t.exportBtn;
  document.getElementById('exportPdfBtn').textContent = t.exportPdfBtn;
  document.getElementById('previewEmpty').textContent = t.previewEmpty;

  // Update sidebar buttons
  Object.keys(TEMPLATE_META).forEach(k => {
    const m = TEMPLATE_META[k][l];
    document.querySelector(`#tpl-${k} .t-name`).textContent = m.name;
    document.querySelector(`#tpl-${k} .t-desc`).textContent = m.desc;
  });

  if (currentTemplate) selectTemplate(currentTemplate);
}

// â”€â”€â”€ TEMPLATE SELECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectTemplate(id) {
  currentTemplate = id;
  formData[id] = formData[id] || {};
  questionCounts[id] = questionCounts[id] || {};

  // Update active button
  document.querySelectorAll('.template-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(`tpl-${id}`).classList.add('active');

  // Show form
  document.getElementById('welcomeScreen').style.display = 'none';
  document.getElementById('formArea').style.display = 'block';

  const tpl = TEMPLATES[id];
  const info = tpl[lang] || tpl['ar'];

  document.getElementById('formTitleEn').textContent = tpl.ar.titleEn;
  document.getElementById('formTitle').textContent = info.title;
  document.getElementById('formSubtitle').textContent = T[lang].formSubtitle;

  renderFields(id, tpl.fields);
  updatePreview(id);
  updateProgress(id);
}

// â”€â”€â”€ RENDER FIELDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderFields(templateId, fields) {
  const container = document.getElementById('fieldsContainer');
  container.innerHTML = '';

  fields.forEach(f => {
    const saved = formData[templateId][f.id] || '';
    const info = f[lang] || f['ar'];
    const ph = f.placeholder[lang] || f.placeholder['ar'];

    const section = document.createElement('div');
    section.className = 'field-section';

    const enLabel = f[lang === 'ar' ? 'en' : 'ar']?.label || '';

    section.innerHTML = `
      <div class="field-header">
        <div class="field-label-wrap">
          <span class="field-label">${info.label}</span>
          <span class="field-label-en">${enLabel}</span>
        </div>
        <button class="field-hint-btn" onclick="toggleHint('hint-${templateId}-${f.id}')" title="${T[lang].hint}">?</button>
      </div>
      <div class="field-body">
        <div class="field-hint-box" id="hint-${templateId}-${f.id}">${info.hint}</div>
        ${renderInput(f, templateId, saved, ph)}
      </div>
    `;
    container.appendChild(section);

    // Re-init questions
    if (f.type === 'questions') {
      const savedQs = formData[templateId][f.id + '_list'] || [''];
      questionCounts[templateId] = questionCounts[templateId] || {};
      questionCounts[templateId][f.id] = savedQs.length;
      renderQuestions(templateId, f.id, savedQs, ph);
    }
  });
}

function renderInput(f, templateId, saved, ph) {
  const options = f.options ? (f.options[lang] || f.options['ar']) : [];

  if (f.type === 'text') {
    return `<input type="text" id="field-${templateId}-${f.id}" placeholder="${ph}" value="${escHtml(saved)}"
      oninput="saveField('${templateId}','${f.id}',this.value)">`;
  }
  if (f.type === 'textarea') {
    return `<textarea id="field-${templateId}-${f.id}" rows="5" placeholder="${ph}"
      oninput="saveField('${templateId}','${f.id}',this.value)">${escHtml(saved)}</textarea>`;
  }
  if (f.type === 'select') {
    const opts = options.map((o, i) => `<option value="${o}" ${saved === o ? 'selected' : ''}>${o}</option>`).join('');
    return `<select class="field-select" id="field-${templateId}-${f.id}"
      onchange="saveField('${templateId}','${f.id}',this.value)">${opts}</select>`;
  }
  if (f.type === 'questions') {
    return `<div class="questions-list" id="qlist-${templateId}-${f.id}"></div>
      <button class="add-q-btn" onclick="addQuestion('${templateId}','${f.id}','${ph}')">${T[lang].addQ}</button>`;
  }
  return '';
}

function renderQuestions(templateId, fieldId, savedQs, ph) {
  const container = document.getElementById(`qlist-${templateId}-${fieldId}`);
  if (!container) return;
  container.innerHTML = '';
  savedQs.forEach((q, i) => {
    const item = document.createElement('div');
    item.className = 'question-item';
    item.innerHTML = `
      <div class="question-num">${i + 1}</div>
      <input type="text" placeholder="${ph}" value="${escHtml(q)}"
        oninput="saveQuestion('${templateId}','${fieldId}',${i},this.value)">
    `;
    container.appendChild(item);
  });
  formData[templateId][fieldId + '_list'] = savedQs;
}

function addQuestion(templateId, fieldId, ph) {
  const list = formData[templateId][fieldId + '_list'] || [''];
  list.push('');
  renderQuestions(templateId, fieldId, list, ph);
}

function saveQuestion(templateId, fieldId, idx, val) {
  formData[templateId][fieldId + '_list'] = formData[templateId][fieldId + '_list'] || [];
  formData[templateId][fieldId + '_list'][idx] = val;
  updatePreview(templateId);
  updateProgress(templateId);
  flashSave();
}

// â”€â”€â”€ FIELD SAVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveField(templateId, fieldId, val) {
  formData[templateId][fieldId] = val;
  updatePreview(templateId);
  updateProgress(templateId);
  flashSave();
}

let saveTimer;
function flashSave() {
  clearTimeout(saveTimer);
  saveTimer = setTimeout(() => {}, 1000);
}

// â”€â”€â”€ HINT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleHint(id) {
  const el = document.getElementById(id);
  if (el) el.classList.toggle('visible');
}

// â”€â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateProgress(templateId) {
  const tpl = TEMPLATES[templateId];
  const total = tpl.fields.length;
  let filled = 0;
  tpl.fields.forEach(f => {
    const val = f.type === 'questions'
      ? (formData[templateId][f.id + '_list'] || []).filter(q => q.trim()).length
      : (formData[templateId][f.id] || '').trim().length;
    if (val > 0) filled++;
  });
  const pct = Math.round((filled / total) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressPct').textContent = pct + '%';
}

// â”€â”€â”€ LIVE PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updatePreview(templateId) {
  const tpl = TEMPLATES[templateId];
  const style = document.getElementById('styleSelect').value;
  document.getElementById('styleTag').textContent = style;
  document.getElementById('previewEmpty').style.display = 'none';

  const title = (tpl[lang] || tpl['ar']).title;
  const data = formData[templateId] || {};

  let html = `
    <div class="doc-uni-header">
      <div class="doc-uni-name">${lang === 'ar' ? 'Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¨Ø§Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠØ©' : 'Academic Research University'}</div>
      <div class="doc-doc-type">${title}</div>
      <div class="doc-style-tag">${style} Format | ${new Date().getFullYear()}</div>
    </div>
  `;

  tpl.fields.forEach(f => {
    const info = f[lang] || f['ar'];
    let val = '';

    if (f.type === 'questions') {
      const list = data[f.id + '_list'] || [];
      val = list.filter(q => q.trim()).map((q, i) => `${i + 1}. ${q}`).join('\n');
    } else {
      val = data[f.id] || '';
    }

    const display = val.trim()
      ? `<div class="doc-section-body">${escHtml(val)}</div>`
      : `<div class="doc-placeholder">${lang === 'ar' ? '[ Ù„Ù… ÙŠÙØ¯Ø®ÙÙ„ Ø¨Ø¹Ø¯ ]' : '[ Not yet entered ]'}</div>`;

    html += `
      <div class="doc-section">
        <div class="doc-section-title">${info.label}</div>
        ${display}
      </div>
    `;
  });

  document.getElementById('previewDoc').innerHTML = html;
}

// â”€â”€â”€ EXPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportDoc() {
  showToast(T[lang].toastWord);
}

function exportPDF() {
  showToast(T[lang].toastPdf);
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// â”€â”€â”€ STYLE CHANGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('styleSelect').addEventListener('change', function () {
  document.getElementById('styleTag').textContent = this.value;
  if (currentTemplate) updatePreview(currentTemplate);
});

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function escHtml(s) {
  if (!s) return '';
  return String(s)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Auto-select proposal on load for demo
setTimeout(() => selectTemplate('proposal'), 300);
</script>
</body>
</html>
